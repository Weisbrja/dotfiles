#!/bin/sh

filename=$(dmenu -l 0 -p 'Filename' <&-)

audio_monitor=$(pactl list sources short | grep 'monitor' | awk '{ print $2 }' | dmenu -p 'Audio monitor')

screen_resolution=$(xrandr -q --current | grep '*' | awk '{ print $1 }' | dmenu -p 'Resolution')

ffmpeg -loglevel error \
	-f pulse -i default \
	-f pulse -i "$audio_monitor" \
	-filter_complex amerge=inputs=2 \
	-f x11grab -s "$screen_resolution" -i :0.0 \
	-c:v h264 -crf 0 -preset ultrafast \
	-c:a aac \
	-r 30 \
	"$filename"
