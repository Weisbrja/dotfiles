#!/bin/sh

if [[ -z $1 ]]
then
	filename=$(dmenu -l 0 -p 'Filename' <&-)
else
	filename="$1"
fi

audio_monitor=$(pactl list sources short | grep 'monitor' | awk '{ print $2 }' | dmenu -p 'Audio monitor')

screen_resolution=$(xrandr -q --current | grep '*' | awk '{ print $1 }' | dmenu -p 'Resolution')

ffmpeg -loglevel error \
	-f pulse -ac 2 -i "$audio_monitor" -itsoffset 00:00:00.5 \
	-f x11grab -s "$screen_resolution" -framerate 30 -i :0.0 \
	-c:v libx264rgb -preset fast -pix_fmt yuv420p \
	-c:a aac \
	"$filename"
