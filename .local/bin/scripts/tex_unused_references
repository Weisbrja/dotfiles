#!/bin/sh

if [ ! "$@" ]
then
	echo "Usage: tex_unused_references file1 ..."
	exit 1
fi

# remove all actual percent signs (\%) and comments (starting with %), then extract all labels
for s in $(sed 's/\\%//g;s/%.*//' "$@" | grep '\\label{.*}' | sed 's/^.*\\label{/ref{/g;s/}.*/}/')
do
	# output the label if it has not been ref'd
	sed 's/%.*//' "$@" | grep -q "$s" || echo "$s" | sed 's/ref{//;s/}$//'
done
